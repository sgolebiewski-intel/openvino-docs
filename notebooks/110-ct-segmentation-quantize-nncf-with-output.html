
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Quantize a Segmentation Model and Show Live Inference &#8212; OpenVINO™  documentation</title>
    
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <link href="../_static/css/media/favicon.ico" rel="shortcut icon">
    <link rel="stylesheet" href="../_static/css/openvino_sphinx_theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/input.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/textfield.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/tabs.css" type="text/css" />
    <script src="../_static/js/openvino_sphinx_theme.js"></script>
    <link rel="stylesheet" href="../_static/css/viewer.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-barchart-background@1.3.0/build/Plugin.Barchart.Background.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
    <script src="../_static/js/viewer.min.js"></script>
    <script src="/assets/versions_raw.js"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/custom.js"></script>
    <script src="../_static/js/graphs.js"></script>
    <script src="../_static/js/graphs_ov_tf.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/target-highlight.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="canonical" href="https://docs.openvino.ai/latest/notebooks/110-ct-segmentation-quantize-nncf-with-output.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quantize a Segmentation Model and Show Live Inference" href="110-ct-segmentation-quantize-with-output.html" />
    <link rel="prev" title="Quantize Speech Recognition Models with OpenVINO™ Post-Training Optimization Tool ​" href="107-speech-recognition-quantization-with-output.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
      <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/get-started-guide.html">
  Get Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/documentation.html">
  Documentation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../tutorials.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api_reference.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../model_zoo.html">
  Model Zoo
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/resources.html">
  Resources
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/openvinotoolkit/openvino" rel="noopener" target="_blank" title="GitHub">
            <span><i class="sst-github"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
</ul>
      </div>
      
      <div class="navbar-end-item">
        
<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="version-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
  <div class="dropdown-menu" aria-labelledby="version-selector">
  </div>
</div>
      </div>
      
      <div class="navbar-end-item">
        

<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="language-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</button>
  <div class="dropdown-menu" aria-labelledby="language-selector">
    
      
        <a class="dropdown-item font-weight-bold" href="/openvino-docs/index.html">English</a>
      
    
      
        <a  class="dropdown-item" href="/cn/openvino-docs/index.html">Chinese</a>
      
    
  </div>
</div>

      </div>
      
    </div>
  </div>
</div>
        <div id="collapse-nav-wrapper" class="container-xl">
          <button id="collapse-nav" class="button bttn-prm button-size-m" type="button" data-toggle="collapse" data-target="#nav-tree" aria-expanded="false" aria-controls="nav-tree">
            Documentation navigation <i class="fas fa-chevron-down"></i>
          </button>
        </div>
      </nav>
      <div class="transition-banner container-fluid alert alert-info alert-dismissible fade show" role="alert">
        <p>OpenVINO 2022.1 introduces a new version of OpenVINO API (API 2.0). For more information on the changes and transition steps, see the <a href="https://docs.openvino.ai/latest/openvino_2_0_transition_guide.html">transition guide</a></p>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
    </div>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar" id="nav-tree"><form class="searchForm bd-search d-flex align-items-center" action="../search.html" method="get">
    <i class="icon fas fa-search"></i>
    <input type="search" class="form-control" name="query" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notebooks
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks-installation.html">
   Installation of OpenVINO™ Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="001-hello-world-with-output.html">
   Hello Image Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="002-openvino-api-with-output.html">
   OpenVINO™ Runtime API Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="003-hello-segmentation-with-output.html">
   Hello Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="004-hello-detection-with-output.html">
   Hello Object Detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="101-tensorflow-to-openvino-with-output.html">
   Convert a TensorFlow Model to OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="102-pytorch-onnx-to-openvino-with-output.html">
   Convert a PyTorch Model to ONNX and OpenVINO™ IR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="103-paddle-onnx-to-openvino-classification-with-output.html">
   Convert a PaddlePaddle Model to ONNX and OpenVINO™ IR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="104-model-tools-with-output.html">
   Working with Open Model Zoo Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="105-language-quantize-bert-with-output.html">
   Quantize NLP models with Post-Training Optimization Tool ​in OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="106-auto-device-with-output.html">
   Automatic Device Selection with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="107-speech-recognition-quantization-with-output.html">
   Quantize Speech Recognition Models with OpenVINO™ Post-Training Optimization Tool ​
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Quantize a Segmentation Model and Show Live Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="110-ct-segmentation-quantize-with-output.html">
   Quantize a Segmentation Model and Show Live Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="111-detection-quantization-with-output.html">
   Object Detection Quantization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="112-pytorch-post-training-quantization-nncf-with-output.html">
   Post-Training Quantization of PyTorch models with NNCF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="113-image-classification-quantization-with-output.html">
   Quantization of Image Classification Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="114-quantization-simplified-mode-with-output.html">
   INT8 Quantization with Post-training Optimization Tool (POT) in Simplified Mode tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="115-async-api-with-output.html">
   Asynchronous Inference with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="201-vision-monodepth-with-output.html">
   Monodepth Estimation with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="202-vision-superresolution-image-with-output.html">
   Single Image Super Resolution with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="202-vision-superresolution-video-with-output.html">
   Video Super Resolution with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="203-meter-reader-with-output.html">
   Industrial Meter Reader
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="204-named-entity-recognition-with-output.html">
   Document Entity Extraction with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="205-vision-background-removal-with-output.html">
   Image Background Removal with U^2-Net and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="206-vision-paddlegan-anime-with-output.html">
   Photos to Anime with PaddleGAN and OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="207-vision-paddlegan-superresolution-with-output.html">
   Super Resolution with PaddleGAN and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="208-optical-character-recognition-with-output.html">
   Optical Character Recognition (OCR) with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="209-handwritten-ocr-with-output.html">
   Handwritten Chinese and Japanese OCR with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="210-ct-scan-live-inference-with-output.html">
   Live Inference and Benchmark CT-scan Data with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="211-speech-to-text-with-output.html">
   Speech to Text with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="212-onnx-style-transfer-with-output.html">
   Style Transfer on ONNX Models with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="214-vision-paddle-classification-with-output.html">
   PaddlePaddle Image Classification with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="215-image-inpainting-with-output.html">
   Image In-painting with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="216-license-plate-recognition-with-output.html">
   License Plate Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="217-vision-deblur-with-output.html">
   Deblur Photos with DeblurGAN-v2 and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="218-vehicle-detection-and-recognition-with-output.html">
   Vehicle Detection And Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="219-knowledge-graphs-conve-with-output.html">
   OpenVINO optimizations for Knowledge graphs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="220-yolov5-accuracy-check-and-quantization-with-output.html">
   Quantize the Ultralytics YOLOv5 model and check accuracy using the OpenVINO POT API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="221-machine-translation-with-output.html">
   Machine translation demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="222-vision-image-colorization-with-output.html">
   Image Colorization with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="223-gpt2-text-prediction-with-output.html">
   GPT-2 Text Prediction with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="301-tensorflow-training-openvino-pot-with-output.html">
   Post-Training Quantization with TensorFlow Classification Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="301-tensorflow-training-openvino-with-output.html">
   From Training to Deployment with TensorFlow and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="302-pytorch-quantization-aware-training-with-output.html">
   Quantization Aware Training with NNCF, using PyTorch framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="305-tensorflow-quantization-aware-training-with-output.html">
   Quantization Aware Training with NNCF, using TensorFlow Framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="401-object-detection-with-output.html">
   Live Object Detection with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="402-pose-estimation-with-output.html">
   Live Human Pose Estimation with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="403-action-recognition-webcam-with-output.html">
   Human Action Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="405-paddle-ocr-webcam-with-output.html">
   PaddleOCR with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="notebook_utils-with-output.html">
   Notebook Utils
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Quantize a Segmentation Model and Show Live Inference
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kidney-segmentation-with-pytorch-lightning-and-openvino-part-3">
     Kidney Segmentation with PyTorch Lightning and OpenVINO™ - Part 3
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instructions">
     Instructions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#settings">
     Settings
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-pytorch-model">
     Load PyTorch Model
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-ct-scan-data">
     Download CT-scan Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuration">
     Configuration
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#dataset">
       Dataset
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#metric">
       Metric
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#quantization">
     Quantization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-fp32-and-int8-model">
   Compare FP32 and INT8 Model
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-file-size">
     Compare File Size
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-metrics">
     Compare Metrics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-performance-of-the-original-and-quantized-models">
     Compare Performance of the Original and Quantized Models
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visually-compare-inference-results">
     Visually Compare Inference Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#show-live-inference">
   Show Live Inference
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-model-and-list-of-image-files">
     Load Model and List of Image Files
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-inference">
     Show Inference
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#references">
     References
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                <div class="tocsection download-docs">
  <div class="dropdown sst-dropdown">
    <button class="button bttn-prm button-size-m" data-display="static" type="button" id="download-options"
      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Download Docs
    </button>
    <div class="dropdown-menu" aria-labelledby="download-options">
      <a class="dropdown-item" href="#" onclick="window.print()">.pdf</a>
      <a id="download-zip-btn" class="dropdown-item" href="#">.zip</a>
    </div>
  </div>
</div>
              </div>
              
            
          </div>
          

          
          
              
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">

<div class="tocsection editthispage">
    <a href="None">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

            
                <div>
                  
  <section id="quantize-a-segmentation-model-and-show-live-inference">
<h1>Quantize a Segmentation Model and Show Live Inference<a class="headerlink" href="#quantize-a-segmentation-model-and-show-live-inference" title="Permalink to this headline">¶</a></h1>
<section id="kidney-segmentation-with-pytorch-lightning-and-openvino-part-3">
<h2>Kidney Segmentation with PyTorch Lightning and OpenVINO™ - Part 3<a class="headerlink" href="#kidney-segmentation-with-pytorch-lightning-and-openvino-part-3" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is part of a series on how to train, optimize, quantize
and show live inference on a medical segmentation model. The goal is to
accelerate inference on a kidney segmentation model. The
<a class="reference external" href="https://arxiv.org/abs/1505.04597">UNet</a> model is trained from
scratch; the data is from
<a class="reference external" href="https://github.com/neheller/kits19">Kits19</a>.</p>
<p>This third tutorial in the series shows how to:</p>
<ul class="simple">
<li><p>Convert an ONNX model to OpenVINO IR with <a class="reference external" href="https://docs.openvino.ai/latest/openvino_docs_MO_DG_Deep_Learning_Model_Optimizer_DevGuide.html">Model
Optimizer</a>,</p></li>
<li><p>Quantize a PyTorch model with NNCF</p></li>
<li><p>Evaluate the F1 score metric of the original model and the quantized
model</p></li>
<li><p>Benchmark performance of the original model and the quantized model</p></li>
<li><p>Show live inference with OpenVINO’s async API</p></li>
</ul>
<p>All notebooks in this series:</p>
<ul class="simple">
<li><p><a class="reference external" href="data-preparation-ct-scan.ipynb">Data Preparation for 2D Segmentation of 3D Medical
Data</a></p></li>
<li><p><a class="reference external" href="pytorch-monai-training.ipynb">Train a 2D-UNet Medical Imaging Model with PyTorch
Lightning</a></p></li>
<li><p>Convert and Quantize a Segmentation Model and Show Live Inference
(this notebook)</p></li>
<li><p><a class="reference external" href="210-ct-scan-live-inference-with-output.html">Live Inference and Benchmark CT-scan
data</a></p></li>
</ul>
</section>
<section id="instructions">
<h2>Instructions<a class="headerlink" href="#instructions" title="Permalink to this headline">¶</a></h2>
<p>This notebook needs a trained UNet model. We provide a pretrained model
trained for 20 epochs with the full
<a class="reference external" href="https://github.com/neheller/kits19">Kits-19</a> frames dataset, which
has an F1 score on the validation set of 0.9. The training code is
available in <a class="reference external" href="pytorch-monai-training.ipynb">this notebook</a>.</p>
<p>NNCF for PyTorch models requires a C++ compiler. On Windows, please
install <a class="reference external" href="https://docs.microsoft.com/en-us/visualstudio/releases/2019/release-notes">Microsoft Visual Studio
2019</a>.
During installation, choose Desktop development with C++ in the
Workloads tab. On macOS, run <code class="docutils literal notranslate"><span class="pre">xcode-select</span> <span class="pre">–install</span></code> from a Terminal.
On Linux, please install gcc.</p>
<p>Running this notebook with the full dataset will take a long time. For
demonstration purposes, this tutorial will download one converted CT
scan and use that scan for quantization and inference. For production
use, please use a representative dataset for quantizing the model.</p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># On Windows, try to find the directory that contains x64 cl.exe and add it to the PATH to enable PyTorch</span>
<span class="c1"># to find the required C++ tools. This code assumes that Visual Studio is installed in the default</span>
<span class="c1"># directory. If you have a different C++ compiler, please add the correct path to os.environ[&quot;PATH&quot;]</span>
<span class="c1"># directly. Note that the C++ Redistributable is not enough to run this notebook.</span>

<span class="c1"># Adding the path to os.environ[&quot;LIB&quot;] is not always required - it depends on the system&#39;s configuration</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">distutils.command.build_ext</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">getwindowsversion</span><span class="p">()</span><span class="o">.</span><span class="n">build</span> <span class="o">&gt;=</span> <span class="mi">20000</span><span class="p">:</span>  <span class="c1"># Windows 11</span>
        <span class="n">search_path</span> <span class="o">=</span> <span class="s2">&quot;**/Hostx64/x64/cl.exe&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">search_path</span> <span class="o">=</span> <span class="s2">&quot;**/Hostx86/x64/cl.exe&quot;</span>

    <span class="n">VS_INSTALL_DIR_2019</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:/Program Files (x86)/Microsoft Visual Studio&quot;</span>
    <span class="n">VS_INSTALL_DIR_2022</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:/Program Files/Microsoft Visual Studio&quot;</span>

    <span class="n">cl_paths_2019</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">VS_INSTALL_DIR_2019</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">search_path</span><span class="p">)))</span>
    <span class="n">cl_paths_2022</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">VS_INSTALL_DIR_2022</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">search_path</span><span class="p">)))</span>
    <span class="n">cl_paths</span> <span class="o">=</span> <span class="n">cl_paths_2019</span> <span class="o">+</span> <span class="n">cl_paths_2022</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cl_paths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot find Visual Studio. This notebook requires an x64 C++ compiler. If you installed &quot;</span>
            <span class="s2">&quot;a C++ compiler, please add the directory that contains cl.exe to `os.environ[&#39;PATH&#39;]`.&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If multiple versions of MSVC are installed, get the most recent version</span>
        <span class="n">cl_path</span> <span class="o">=</span> <span class="n">cl_paths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">vs_dir</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cl_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="si">}{</span><span class="n">vs_dir</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Code for finding the library dirs from</span>
        <span class="c1"># https://stackoverflow.com/questions/47423246/get-pythons-lib-path</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">distutils</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Distribution</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">distutils</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">build_ext</span><span class="o">.</span><span class="n">build_ext</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">finalize_options</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LIB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">library_dirs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">vs_dir</span><span class="si">}</span><span class="s2"> to PATH&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">monai</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">monai.transforms</span> <span class="kn">import</span> <span class="n">LoadImage</span>
<span class="kn">from</span> <span class="nn">nncf.common.utils.logger</span> <span class="kn">import</span> <span class="n">set_log_level</span>
<span class="kn">from</span> <span class="nn">openvino.inference_engine</span> <span class="kn">import</span> <span class="n">IECore</span>
<span class="kn">from</span> <span class="nn">openvino.runtime</span> <span class="kn">import</span> <span class="n">Core</span>
<span class="kn">from</span> <span class="nn">torch.jit</span> <span class="kn">import</span> <span class="n">TracerWarning</span>
<span class="kn">from</span> <span class="nn">torchmetrics</span> <span class="kn">import</span> <span class="n">F1</span>

<span class="n">set_log_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>  <span class="c1"># Disables all NNCF info and warning messages</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;../utils&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">models.custom_segmentation</span> <span class="kn">import</span> <span class="n">SegmentationModel</span>
<span class="kn">from</span> <span class="nn">notebook_utils</span> <span class="kn">import</span> <span class="n">NotebookAlert</span><span class="p">,</span> <span class="n">benchmark_model</span><span class="p">,</span> <span class="n">download_file</span><span class="p">,</span> <span class="n">show_live_inference</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>

    <span class="kn">from</span> <span class="nn">nncf</span> <span class="kn">import</span> <span class="n">NNCFConfig</span>
    <span class="kn">from</span> <span class="nn">nncf.torch</span> <span class="kn">import</span> <span class="n">create_compressed_model</span><span class="p">,</span> <span class="n">register_default_init_args</span>
<span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;WARNING: Running this notebook requires an x64 C++ compiler.&quot;</span>
    <span class="n">NotebookAlert</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">alert_class</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="p">)</span>
    <span class="k">raise</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">No</span> <span class="n">CUDA</span> <span class="n">runtime</span> <span class="ow">is</span> <span class="n">found</span><span class="p">,</span> <span class="n">using</span> <span class="n">CUDA_HOME</span><span class="o">=</span><span class="s1">&#39;/usr/local/cuda&#39;</span>
</pre></div>
</div>
</section>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h2>
<p>By default, this notebook will download one CT scan from the KITS19
dataset, and use that for quantization. To use the full dataset, set
<code class="docutils literal notranslate"><span class="pre">BASEDIR</span></code> to the path of the dataset, as prepared according to the
<a class="reference external" href="data-preparation-ct-scan.ipynb">Data Preparation</a> notebook.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BASEDIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;kits19_frames_1&quot;</span><span class="p">)</span>
<span class="c1"># Uncomment the line below to use the full dataset, as prepared in the data preparation notebook</span>
<span class="c1"># BASEDIR = Path(&quot;~/kits19/kits19_frames&quot;).expanduser()</span>
<span class="n">MODEL_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
<span class="n">MODEL_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-pytorch-model">
<h2>Load PyTorch Model<a class="headerlink" href="#load-pytorch-model" title="Permalink to this headline">¶</a></h2>
<p>Download the pretrained model weights, load the PyTorch model and the
state_dict that was saved after training. The model used in this
notebook is a
<a class="reference external" href="https://docs.monai.io/en/stable/networks.html#basicunet">BasicUnet</a>
model from <a class="reference external" href="https://monai.io">MONAI</a>. We provide a pretrained
checkpoint. To see how this model yourself, check out the <a class="reference external" href="pytorch-monai-training.ipynb">training
notebook</a>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">state_dict_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/helena-intel/openvino_notebooks/raw/110-nncf/notebooks/110-ct-segmentation-quantize/pretrained_model/unet_kits19_state_dict.pth&quot;</span>
<span class="n">state_dict_file</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">state_dict_url</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;pretrained_model&quot;</span><span class="p">)</span>
<span class="n">state_dict</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">state_dict_file</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">))</span>

<span class="n">new_state_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">new_key</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_model.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">new_state_dict</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="n">new_state_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;loss_function.pos_weight&quot;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">monai</span><span class="o">.</span><span class="n">networks</span><span class="o">.</span><span class="n">nets</span><span class="o">.</span><span class="n">BasicUNet</span><span class="p">(</span><span class="n">spatial_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">new_state_dict</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pretrained_model/unet_kits19_state_dict.pth:   0%|          | 0.00/7.58M [00:00&lt;?, ?B/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BasicUNet</span> <span class="n">features</span><span class="p">:</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">All</span> <span class="n">keys</span> <span class="n">matched</span> <span class="n">successfully</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>We export the PyTorch model to ONNX and convert it to OpenVINO IR, for
comparing the performance of the FP32 and INT8 model later in this
notebook</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">fp32_onnx_path</span> <span class="o">=</span> <span class="n">MODEL_DIR</span> <span class="o">/</span> <span class="s2">&quot;unet_kits19_fp32.onnx&quot;</span>
<span class="n">torch</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dummy_input</span><span class="p">,</span> <span class="n">fp32_onnx_path</span><span class="p">)</span>
<span class="o">!</span>mo --input_model <span class="s2">&quot;</span><span class="nv">$fp32_onnx_path</span><span class="s2">&quot;</span> --output_dir <span class="nv">$MODEL_DIR</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">monai</span><span class="o">/</span><span class="n">networks</span><span class="o">/</span><span class="n">nets</span><span class="o">/</span><span class="n">basic_unet</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">179</span><span class="p">:</span> <span class="n">TracerWarning</span><span class="p">:</span> <span class="n">Converting</span> <span class="n">a</span> <span class="n">tensor</span> <span class="n">to</span> <span class="n">a</span> <span class="n">Python</span> <span class="n">boolean</span> <span class="n">might</span> <span class="n">cause</span> <span class="n">the</span> <span class="n">trace</span> <span class="n">to</span> <span class="n">be</span> <span class="n">incorrect</span><span class="o">.</span> <span class="n">We</span> <span class="n">can</span><span class="s1">&#39;t record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!</span>
  <span class="k">if</span> <span class="n">x_e</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">x_0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">Common</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Input</span> <span class="n">Model</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">unet_kits19_fp32</span><span class="o">.</span><span class="n">onnx</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="k">for</span> <span class="n">generated</span> <span class="n">IR</span><span class="p">:</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span>
    <span class="o">-</span> <span class="n">IR</span> <span class="n">output</span> <span class="n">name</span><span class="p">:</span>   <span class="n">unet_kits19_fp32</span>
    <span class="o">-</span> <span class="n">Log</span> <span class="n">level</span><span class="p">:</span>    <span class="n">ERROR</span>
    <span class="o">-</span> <span class="n">Batch</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">layers</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Output</span> <span class="n">layers</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">shapes</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Source</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Target</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Layout</span><span class="p">:</span>   <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Mean</span> <span class="n">values</span><span class="p">:</span>  <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">values</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">factor</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Precision</span> <span class="n">of</span> <span class="n">IR</span><span class="p">:</span>  <span class="n">FP32</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">fusing</span><span class="p">:</span>    <span class="kc">True</span>
    <span class="o">-</span> <span class="n">User</span> <span class="n">transformations</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Reverse</span> <span class="nb">input</span> <span class="n">channels</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">IR</span> <span class="n">generation</span> <span class="k">for</span> <span class="n">fixed</span> <span class="nb">input</span> <span class="n">shape</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">transformations</span> <span class="n">config</span> <span class="n">file</span><span class="p">:</span>  <span class="kc">None</span>
<span class="n">Advanced</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">legacy</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">new</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>  <span class="kc">False</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">found</span> <span class="ow">in</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">openvino</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">version</span><span class="p">:</span>   <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">version</span><span class="p">:</span>    <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Generated</span> <span class="n">IR</span> <span class="n">version</span> <span class="mi">11</span> <span class="n">model</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">XML</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">unet_kits19_fp32</span><span class="o">.</span><span class="n">xml</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">BIN</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">unet_kits19_fp32</span><span class="o">.</span><span class="n">bin</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Total</span> <span class="n">execution</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.44</span> <span class="n">seconds</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Memory</span> <span class="n">consumed</span><span class="p">:</span> <span class="mi">85</span> <span class="n">MB</span><span class="o">.</span>
<span class="n">It</span><span class="s1">&#39;s been a while, check for a new version of Intel(R) Distribution of OpenVINO(TM) toolkit here https://software.intel.com/content/www/us/en/develop/tools/openvino-toolkit/download.html?cid=other&amp;source=prod&amp;campid=ww_2022_bu_IOTG_OpenVINO-2022-1&amp;content=upg_all&amp;medium=organic or on the GitHub*</span>
<span class="p">[</span> <span class="n">INFO</span> <span class="p">]</span> <span class="n">The</span> <span class="n">model</span> <span class="n">was</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">IR</span> <span class="n">v11</span><span class="p">,</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">model</span> <span class="nb">format</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">source</span> <span class="n">DL</span> <span class="n">framework</span> <span class="nb">input</span><span class="o">/</span><span class="n">output</span> <span class="nb">format</span><span class="o">.</span> <span class="n">While</span> <span class="n">IR</span> <span class="n">v11</span> <span class="ow">is</span> <span class="n">backwards</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">OpenVINO</span> <span class="n">Inference</span> <span class="n">Engine</span> <span class="n">API</span> <span class="n">v1</span><span class="mf">.0</span><span class="p">,</span> <span class="n">please</span> <span class="n">use</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="p">(</span><span class="k">as</span> <span class="n">of</span> <span class="mf">2022.1</span><span class="p">)</span> <span class="n">to</span> <span class="n">take</span> <span class="n">advantage</span> <span class="n">of</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">improvements</span> <span class="ow">in</span> <span class="n">IR</span> <span class="n">v11</span><span class="o">.</span>
<span class="n">Find</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="ow">and</span> <span class="n">IR</span> <span class="n">v11</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">openvino</span><span class="o">.</span><span class="n">ai</span>
</pre></div>
</div>
</section>
<section id="download-ct-scan-data">
<h2>Download CT-scan Data<a class="headerlink" href="#download-ct-scan-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The CT scan case number. For example: 2 for data from the case_00002 directory</span>
<span class="c1"># Currently only 117 is supported</span>
<span class="n">CASE</span> <span class="o">=</span> <span class="mi">117</span>
<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">BASEDIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;case_</span><span class="si">{</span><span class="n">CASE</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">BASEDIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://storage.openvinotoolkit.org/data/test_data/openvino_notebooks/kits19/case_</span><span class="si">{</span><span class="n">CASE</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">.zip&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
        <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">BASEDIR</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>  <span class="c1"># remove zipfile</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded and extracted data for case_</span><span class="si">{</span><span class="n">CASE</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data for case_</span><span class="si">{</span><span class="n">CASE</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2"> exists&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>case_00117.zip:   0%|          | 0.00/5.48M [00:00&lt;?, ?B/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Downloaded</span> <span class="ow">and</span> <span class="n">extracted</span> <span class="n">data</span> <span class="k">for</span> <span class="n">case_00117</span>
</pre></div>
</div>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<section id="dataset">
<h3>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h3>
<p>The KitsDataset class in the next cell expects images and masks in the
<em>basedir</em> directory, in a folder per patient. It is a simplified version
of the DataSet class in the <a class="reference external" href="pytorch-monai-training.ipynb">training
notebook</a>.</p>
<p>Images are loaded with MONAI’s
<code class="docutils literal notranslate"><span class="pre">`LoadImage</span></code> &lt;<a class="reference external" href="https://docs.monai.io/en/stable/transforms.html#loadimage">https://docs.monai.io/en/stable/transforms.html#loadimage</a>&gt;`__,
to align with the image loading method in the training notebook. This
method rotates and flips the images. We define a <code class="docutils literal notranslate"><span class="pre">rotate_and_flip</span></code>
method to display the images in the expected orientation.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rotate_and_flip</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rotate `image` by 90 degrees and flip horizontally&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">rotateCode</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">ROTATE_90_CLOCKWISE</span><span class="p">),</span> <span class="n">flipCode</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">KitsDataset</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basedir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dataset class for prepared Kits19 data, for binary segmentation (background/kidney)</span>
<span class="sd">        Source data should exist in basedir, in subdirectories case_00000 until case_00210,</span>
<span class="sd">        with each subdirectory containing directories imaging_frames, with jpg images, and</span>
<span class="sd">        segmentation_frames with segmentation masks as png files.</span>
<span class="sd">        See https://github.com/openvinotoolkit/openvino_notebooks/blob/main/notebooks/110-ct-segmentation-quantize/data-preparation-ct-scan.ipynb</span>

<span class="sd">        :param basedir: Directory that contains the prepared CT scans</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">BASEDIR</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;case_*/segmentation_frames/*png&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basedir</span> <span class="o">=</span> <span class="n">basedir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">masks</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Created dataset with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> items. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Base directory for data: </span><span class="si">{</span><span class="n">basedir</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an item from the dataset at the specified index.</span>

<span class="sd">        :return: (image, segmentation_mask)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">image_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mask_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;segmentation_frames&quot;</span><span class="p">,</span> <span class="s2">&quot;imaging_frames&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Load images with MONAI&#39;s LoadImage to match data loading in training notebook</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">LoadImage</span><span class="p">(</span><span class="n">image_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)(</span><span class="nb">str</span><span class="p">(</span><span class="n">mask_path</span><span class="p">))</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">LoadImage</span><span class="p">(</span><span class="n">image_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)(</span><span class="nb">str</span><span class="p">(</span><span class="n">image_path</span><span class="p">))</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">))</span>

        <span class="n">input_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">mask</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
</pre></div>
</div>
<p>To test that the data loader returns the expected output, we show an
image and a mask. The image and mask are shown as returned by the
dataloader, after resizing and preprocessing. Since this dataset
contains a lot of slices without kidneys, we select a slice that
contains at least 5000 kidney pixels to verify that the annotations look
correct.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">KitsDataset</span><span class="p">(</span><span class="n">BASEDIR</span><span class="p">)</span>
<span class="c1"># Find a slice that contains kidney annotations</span>
<span class="c1"># item[0] is the annotation: (id, annotation_data)</span>
<span class="n">image_data</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">)</span>
<span class="c1"># Remove extra image dimension and rotate and flip the image for visualization</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">rotate_and_flip</span><span class="p">(</span><span class="n">image_data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>

<span class="c1"># The data loader returns annotations as (index, mask) and mask in shape (H,W)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">rotate_and_flip</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Created</span> <span class="n">dataset</span> <span class="k">with</span> <span class="mi">69</span> <span class="n">items</span><span class="o">.</span> <span class="n">Base</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">data</span><span class="p">:</span> <span class="n">kits19_frames_1</span>
</pre></div>
</div>
<img alt="../_images/110-ct-segmentation-quantize-nncf-with-output_16_1.png" src="../_images/110-ct-segmentation-quantize-nncf-with-output_16_1.png" />
</section>
<section id="metric">
<h3>Metric<a class="headerlink" href="#metric" title="Permalink to this headline">¶</a></h3>
<p>Define a metric to determine the performance of the model.</p>
<p>For this demo, we use the <a class="reference external" href="https://en.wikipedia.org/wiki/F-score">F1
score</a>, or Dice coefficient,
from the
<a class="reference external" href="https://torchmetrics.readthedocs.io/en/stable/">TorchMetrics</a>
library.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_f1</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">KitsDataset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute binary F1 score of `model` on `dataset`</span>
<span class="sd">    F1 score metric is provided by the torchmetrics library</span>
<span class="sd">    `model` is expected to be a binary segmentation model, images in the</span>
<span class="sd">    dataset are expected in (N,C,H,W) format where N==C==1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">F1</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
            <span class="n">input_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
            <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">prediction</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="quantization">
<h2>Quantization<a class="headerlink" href="#quantization" title="Permalink to this headline">¶</a></h2>
<p>Before quantizing the model, we compute the F1 score on the FP32 model
for comparison</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fp32_f1</span> <span class="o">=</span> <span class="n">compute_f1</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FP32 F1: </span><span class="si">{</span><span class="n">fp32_f1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FP32</span> <span class="n">F1</span><span class="p">:</span> <span class="mf">0.974</span>
</pre></div>
</div>
<p>NNCF configuration can be defined in a json file or a dictionary. See
the <a class="reference external" href="https://github.com/openvinotoolkit/nncf/blob/develop/docs/compression_algorithms/Quantization.md">NNCF quantization
documentation</a>
for more information on the possible values.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NNCF uses the model loaded at the beginning of this notebook. If after quantizing the model, you</span>
<span class="c1"># want to quantize with a different config, reload the model by uncommenting the next two lines</span>
<span class="c1">#</span>
<span class="c1"># model = monai.networks.nets.BasicUNet(spatial_dims=2, in_channels=1, out_channels=1).eval()</span>
<span class="c1"># model.load_state_dict(new_state_dict)</span>

<span class="n">nncf_config_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;input_info&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sample_size&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">]},</span>
    <span class="s2">&quot;target_device&quot;</span><span class="p">:</span> <span class="s2">&quot;CPU&quot;</span><span class="p">,</span>
    <span class="s2">&quot;compression&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;quantization&quot;</span><span class="p">,</span>
        <span class="c1"># performance preset uses symmetric weights and activations</span>
        <span class="s2">&quot;preset&quot;</span><span class="p">:</span> <span class="s2">&quot;performance&quot;</span><span class="p">,</span>
        <span class="c1"># Do not quantize LeakyReLU activations to allow the INT8 model to run on Intel GPU</span>
        <span class="s2">&quot;ignored_scopes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{re}</span><span class="s2">.*LeakyReLU*&quot;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">nncf_config</span> <span class="o">=</span> <span class="n">NNCFConfig</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nncf_config_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a quantized model from a pre-trained FP32 model and configuration
object created with the dictionary defined in the previous cell and a
DataLoader. See the <a class="reference external" href="https://github.com/openvinotoolkit/nncf/blob/develop/docs/Usage.md">NNCF
documentation</a>
for more information.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">nncf_config</span> <span class="o">=</span> <span class="n">register_default_init_args</span><span class="p">(</span><span class="n">nncf_config</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">)</span>
<span class="n">compression_ctrl</span><span class="p">,</span> <span class="n">compressed_model</span> <span class="o">=</span> <span class="n">create_compressed_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nncf_config</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">compressed_model</span></code> that was created in the previous cell is a
PyTorch <code class="docutils literal notranslate"><span class="pre">nn.Module</span></code> that is wrapped by NNCF.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compressed_model</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NNCFNetwork</span><span class="p">(</span>
  <span class="p">(</span><span class="n">nncf_module</span><span class="p">):</span> <span class="n">BasicUNet</span><span class="p">(</span>
    <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
      <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
          <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
              <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
          <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
          <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
          <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
          <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
          <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
              <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
          <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
          <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
          <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">down_1</span><span class="p">):</span> <span class="n">Down</span><span class="p">(</span>
      <span class="p">(</span><span class="n">max_pooling</span><span class="p">):</span> <span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ceil_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">down_2</span><span class="p">):</span> <span class="n">Down</span><span class="p">(</span>
      <span class="p">(</span><span class="n">max_pooling</span><span class="p">):</span> <span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ceil_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">down_3</span><span class="p">):</span> <span class="n">Down</span><span class="p">(</span>
      <span class="p">(</span><span class="n">max_pooling</span><span class="p">):</span> <span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ceil_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">down_4</span><span class="p">):</span> <span class="n">Down</span><span class="p">(</span>
      <span class="p">(</span><span class="n">max_pooling</span><span class="p">):</span> <span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dilation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ceil_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">upcat_4</span><span class="p">):</span> <span class="n">UpCat</span><span class="p">(</span>
      <span class="p">(</span><span class="n">upsample</span><span class="p">):</span> <span class="n">UpSample</span><span class="p">(</span>
        <span class="p">(</span><span class="n">deconv</span><span class="p">):</span> <span class="n">NNCFConvTranspose2d</span><span class="p">(</span>
          <span class="mi">256</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
          <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
              <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
        <span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">256</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">upcat_3</span><span class="p">):</span> <span class="n">UpCat</span><span class="p">(</span>
      <span class="p">(</span><span class="n">upsample</span><span class="p">):</span> <span class="n">UpSample</span><span class="p">(</span>
        <span class="p">(</span><span class="n">deconv</span><span class="p">):</span> <span class="n">NNCFConvTranspose2d</span><span class="p">(</span>
          <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
          <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
              <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
        <span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">upcat_2</span><span class="p">):</span> <span class="n">UpCat</span><span class="p">(</span>
      <span class="p">(</span><span class="n">upsample</span><span class="p">):</span> <span class="n">UpSample</span><span class="p">(</span>
        <span class="p">(</span><span class="n">deconv</span><span class="p">):</span> <span class="n">NNCFConvTranspose2d</span><span class="p">(</span>
          <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
          <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
              <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
        <span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">upcat_1</span><span class="p">):</span> <span class="n">UpCat</span><span class="p">(</span>
      <span class="p">(</span><span class="n">upsample</span><span class="p">):</span> <span class="n">UpSample</span><span class="p">(</span>
        <span class="p">(</span><span class="n">deconv</span><span class="p">):</span> <span class="n">NNCFConvTranspose2d</span><span class="p">(</span>
          <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
          <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
              <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
        <span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">convs</span><span class="p">):</span> <span class="n">TwoConv</span><span class="p">(</span>
        <span class="p">(</span><span class="n">conv_0</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">64</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
        <span class="p">(</span><span class="n">conv_1</span><span class="p">):</span> <span class="n">Convolution</span><span class="p">(</span>
          <span class="p">(</span><span class="n">conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
            <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
              <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
                <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
              <span class="p">)</span>
            <span class="p">)</span>
            <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
          <span class="p">)</span>
          <span class="p">(</span><span class="n">adn</span><span class="p">):</span> <span class="n">ADN</span><span class="p">(</span>
            <span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="n">InstanceNorm2d</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">D</span><span class="p">):</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="n">LeakyReLU</span><span class="p">(</span><span class="n">negative_slope</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
          <span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="n">final_conv</span><span class="p">):</span> <span class="n">NNCFConv2d</span><span class="p">(</span>
      <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="n">pre_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">):</span> <span class="n">UpdateWeight</span><span class="p">(</span>
          <span class="p">(</span><span class="n">op</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
      <span class="p">)</span>
      <span class="p">(</span><span class="n">post_ops</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">()</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="n">external_quantizers</span><span class="p">):</span> <span class="n">ModuleDict</span><span class="p">(</span>
    <span class="p">(</span><span class="o">/</span><span class="n">nncf_model_input_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_1</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_1</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">;</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_2</span><span class="p">]</span><span class="o">/</span><span class="n">UpSample</span><span class="p">[</span><span class="n">upsample</span><span class="p">]</span><span class="o">/</span><span class="n">NNCFConvTranspose2d</span><span class="p">[</span><span class="n">deconv</span><span class="p">]</span><span class="o">/</span><span class="n">conv_transpose2d_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_2</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_2</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">;</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_3</span><span class="p">]</span><span class="o">/</span><span class="n">UpSample</span><span class="p">[</span><span class="n">upsample</span><span class="p">]</span><span class="o">/</span><span class="n">NNCFConvTranspose2d</span><span class="p">[</span><span class="n">deconv</span><span class="p">]</span><span class="o">/</span><span class="n">conv_transpose2d_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_3</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_3</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">;</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_4</span><span class="p">]</span><span class="o">/</span><span class="n">UpSample</span><span class="p">[</span><span class="n">upsample</span><span class="p">]</span><span class="o">/</span><span class="n">NNCFConvTranspose2d</span><span class="p">[</span><span class="n">deconv</span><span class="p">]</span><span class="o">/</span><span class="n">conv_transpose2d_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_4</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">Down</span><span class="p">[</span><span class="n">down_4</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">;</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_1</span><span class="p">]</span><span class="o">/</span><span class="n">UpSample</span><span class="p">[</span><span class="n">upsample</span><span class="p">]</span><span class="o">/</span><span class="n">NNCFConvTranspose2d</span><span class="p">[</span><span class="n">deconv</span><span class="p">]</span><span class="o">/</span><span class="n">conv_transpose2d_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_1</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_1</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_2</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_2</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_3</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_3</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_4</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_0</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">(</span><span class="n">BasicUNet</span><span class="o">/</span><span class="n">UpCat</span><span class="p">[</span><span class="n">upcat_4</span><span class="p">]</span><span class="o">/</span><span class="n">TwoConv</span><span class="p">[</span><span class="n">convs</span><span class="p">]</span><span class="o">/</span><span class="n">Convolution</span><span class="p">[</span><span class="n">conv_1</span><span class="p">]</span><span class="o">/</span><span class="n">ADN</span><span class="p">[</span><span class="n">adn</span><span class="p">]</span><span class="o">/</span><span class="n">LeakyReLU</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">/</span><span class="n">leaky_relu_0</span><span class="o">|</span><span class="n">OUTPUT</span><span class="p">):</span> <span class="n">SymmetricQuantizer</span><span class="p">(</span><span class="n">bit</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In this notebook we demonstrate post-training quantization with NNCF. To
use the quantized model for faster inference with OpenVINO, we export
the model to ONNX, and convert the ONNX model to OpenVINO’s IR format.</p>
<p>NNCF also supports quantization-aware training, and other algorithms
than quantization. See the <a class="reference external" href="https://github.com/openvinotoolkit/nncf/">NNCF
documentation</a> in the NNCF
repository for more information.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int8_onnx_path</span> <span class="o">=</span> <span class="n">MODEL_DIR</span> <span class="o">/</span> <span class="s2">&quot;unet_kits19_int8.onnx&quot;</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">TracerWarning</span><span class="p">)</span>  <span class="c1"># Ignore export warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
<span class="n">compression_ctrl</span><span class="o">.</span><span class="n">export_model</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">int8_onnx_path</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INT8 ONNX model exported to </span><span class="si">{</span><span class="n">int8_onnx_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="o">!</span>mo --input_model <span class="s2">&quot;</span><span class="nv">$int8_onnx_path</span><span class="s2">&quot;</span> --input_shape <span class="s2">&quot;[1,1,512,512]&quot;</span> --output_dir <span class="s2">&quot;</span><span class="nv">$MODEL_DIR</span><span class="s2">&quot;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INT8</span> <span class="n">ONNX</span> <span class="n">model</span> <span class="n">exported</span> <span class="n">to</span> <span class="n">model</span><span class="o">/</span><span class="n">unet_kits19_int8</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span>
<span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">Common</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Input</span> <span class="n">Model</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">unet_kits19_int8</span><span class="o">.</span><span class="n">onnx</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="k">for</span> <span class="n">generated</span> <span class="n">IR</span><span class="p">:</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span>
    <span class="o">-</span> <span class="n">IR</span> <span class="n">output</span> <span class="n">name</span><span class="p">:</span>   <span class="n">unet_kits19_int8</span>
    <span class="o">-</span> <span class="n">Log</span> <span class="n">level</span><span class="p">:</span>    <span class="n">ERROR</span>
    <span class="o">-</span> <span class="n">Batch</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">layers</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Output</span> <span class="n">layers</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">shapes</span><span class="p">:</span>     <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">512</span><span class="p">,</span><span class="mi">512</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">Source</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Target</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Layout</span><span class="p">:</span>   <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Mean</span> <span class="n">values</span><span class="p">:</span>  <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">values</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">factor</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Precision</span> <span class="n">of</span> <span class="n">IR</span><span class="p">:</span>  <span class="n">FP32</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">fusing</span><span class="p">:</span>    <span class="kc">True</span>
    <span class="o">-</span> <span class="n">User</span> <span class="n">transformations</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Reverse</span> <span class="nb">input</span> <span class="n">channels</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">IR</span> <span class="n">generation</span> <span class="k">for</span> <span class="n">fixed</span> <span class="nb">input</span> <span class="n">shape</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">transformations</span> <span class="n">config</span> <span class="n">file</span><span class="p">:</span>  <span class="kc">None</span>
<span class="n">Advanced</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">legacy</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">new</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>  <span class="kc">False</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">found</span> <span class="ow">in</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">openvino</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">version</span><span class="p">:</span>   <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">version</span><span class="p">:</span>    <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Generated</span> <span class="n">IR</span> <span class="n">version</span> <span class="mi">11</span> <span class="n">model</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">XML</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">unet_kits19_int8</span><span class="o">.</span><span class="n">xml</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">BIN</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">110</span><span class="o">-</span><span class="n">ct</span><span class="o">-</span><span class="n">segmentation</span><span class="o">-</span><span class="n">quantize</span><span class="o">/</span><span class="n">model</span><span class="o">/</span><span class="n">unet_kits19_int8</span><span class="o">.</span><span class="n">bin</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Total</span> <span class="n">execution</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.54</span> <span class="n">seconds</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Memory</span> <span class="n">consumed</span><span class="p">:</span> <span class="mi">89</span> <span class="n">MB</span><span class="o">.</span>
<span class="n">It</span><span class="s1">&#39;s been a while, check for a new version of Intel(R) Distribution of OpenVINO(TM) toolkit here https://software.intel.com/content/www/us/en/develop/tools/openvino-toolkit/download.html?cid=other&amp;source=prod&amp;campid=ww_2022_bu_IOTG_OpenVINO-2022-1&amp;content=upg_all&amp;medium=organic or on the GitHub*</span>
<span class="p">[</span> <span class="n">INFO</span> <span class="p">]</span> <span class="n">The</span> <span class="n">model</span> <span class="n">was</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">IR</span> <span class="n">v11</span><span class="p">,</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">model</span> <span class="nb">format</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">source</span> <span class="n">DL</span> <span class="n">framework</span> <span class="nb">input</span><span class="o">/</span><span class="n">output</span> <span class="nb">format</span><span class="o">.</span> <span class="n">While</span> <span class="n">IR</span> <span class="n">v11</span> <span class="ow">is</span> <span class="n">backwards</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">OpenVINO</span> <span class="n">Inference</span> <span class="n">Engine</span> <span class="n">API</span> <span class="n">v1</span><span class="mf">.0</span><span class="p">,</span> <span class="n">please</span> <span class="n">use</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="p">(</span><span class="k">as</span> <span class="n">of</span> <span class="mf">2022.1</span><span class="p">)</span> <span class="n">to</span> <span class="n">take</span> <span class="n">advantage</span> <span class="n">of</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">improvements</span> <span class="ow">in</span> <span class="n">IR</span> <span class="n">v11</span><span class="o">.</span>
<span class="n">Find</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="ow">and</span> <span class="n">IR</span> <span class="n">v11</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">openvino</span><span class="o">.</span><span class="n">ai</span>
</pre></div>
</div>
</section>
</section>
<section id="compare-fp32-and-int8-model">
<h1>Compare FP32 and INT8 Model<a class="headerlink" href="#compare-fp32-and-int8-model" title="Permalink to this headline">¶</a></h1>
<section id="compare-file-size">
<h2>Compare File Size<a class="headerlink" href="#compare-file-size" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fp32_ir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">fp32_onnx_path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">)</span>
<span class="n">int8_ir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">int8_onnx_path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.xml&quot;</span><span class="p">)</span>

<span class="n">original_model_size</span> <span class="o">=</span> <span class="n">fp32_ir_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.bin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="mi">1024</span>
<span class="n">quantized_model_size</span> <span class="o">=</span> <span class="n">int8_ir_path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.bin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">/</span> <span class="mi">1024</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FP32 model size: </span><span class="si">{</span><span class="n">original_model_size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> KB&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INT8 model size: </span><span class="si">{</span><span class="n">quantized_model_size</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> KB&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FP32</span> <span class="n">model</span> <span class="n">size</span><span class="p">:</span> <span class="mf">7728.27</span> <span class="n">KB</span>
<span class="n">INT8</span> <span class="n">model</span> <span class="n">size</span><span class="p">:</span> <span class="mf">1953.49</span> <span class="n">KB</span>
</pre></div>
</div>
</section>
<section id="compare-metrics">
<h2>Compare Metrics<a class="headerlink" href="#compare-metrics" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">int8_f1</span> <span class="o">=</span> <span class="n">compute_f1</span><span class="p">(</span><span class="n">compressed_model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FP32 F1: </span><span class="si">{</span><span class="n">fp32_f1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INT8 F1: </span><span class="si">{</span><span class="n">int8_f1</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FP32</span> <span class="n">F1</span><span class="p">:</span> <span class="mf">0.974</span>
<span class="n">INT8</span> <span class="n">F1</span><span class="p">:</span> <span class="mf">0.967</span>
</pre></div>
</div>
</section>
<section id="compare-performance-of-the-original-and-quantized-models">
<h2>Compare Performance of the Original and Quantized Models<a class="headerlink" href="#compare-performance-of-the-original-and-quantized-models" title="Permalink to this headline">¶</a></h2>
<p>To measure the inference performance of the FP32 and INT8 models, we use
<a class="reference external" href="https://docs.openvino.ai/latest/openvino_inference_engine_tools_benchmark_tool_README.html">Benchmark
Tool</a>,
OpenVINO’s inference performance measurement tool. Benchmark tool is a
command line application, part of OpenVINO development tools, that can
be run in the notebook with <code class="docutils literal notranslate"><span class="pre">!</span> <span class="pre">benchmark_app</span></code> or
<code class="docutils literal notranslate"><span class="pre">%sx</span> <span class="pre">benchmark_app</span></code>.</p>
<p>In this tutorial, we use a wrapper function from <a class="reference external" href="https://github.com/openvinotoolkit/openvino_notebooks/blob/main/notebooks/utils/notebook_utils.ipynb">Notebook
Utils</a>.
It prints the <code class="docutils literal notranslate"><span class="pre">benchmark_app</span></code> command with the chosen parameters.</p>
<blockquote>
<div><p>NOTE: For the most accurate performance estimation, we recommended
running <code class="docutils literal notranslate"><span class="pre">benchmark_app</span></code> in a terminal/command prompt after closing
other applications. Run <code class="docutils literal notranslate"><span class="pre">benchmark_app</span> <span class="pre">--help</span></code> to see all command
line options.</p>
</div></blockquote>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the parameters and docstring for `benchmark_model`</span>
benchmark_model<span class="o">?</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;CPU&quot;</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Benchmark FP32 model</span>
<span class="n">benchmark_model</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="n">fp32_ir_path</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Benchmark unet_kits19_fp32.xml with CPU for 15 seconds with async
inference</strong></p>
<p>Benchmark command:
<code class="docutils literal notranslate"><span class="pre">benchmark_app</span> <span class="pre">-m</span> <span class="pre">model/unet_kits19_fp32.xml</span> <span class="pre">-d</span> <span class="pre">CPU</span> <span class="pre">-t</span> <span class="pre">15</span> <span class="pre">-api</span> <span class="pre">async</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-cdir</span> <span class="pre">model_cache</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Count</span><span class="p">:</span>          <span class="mi">408</span> <span class="n">iterations</span>
<span class="n">Duration</span><span class="p">:</span>       <span class="mf">15348.30</span> <span class="n">ms</span>
<span class="n">Latency</span><span class="p">:</span>
    <span class="n">Median</span><span class="p">:</span>     <span class="mf">225.30</span> <span class="n">ms</span>
    <span class="n">AVG</span><span class="p">:</span>        <span class="mf">224.95</span> <span class="n">ms</span>
    <span class="n">MIN</span><span class="p">:</span>        <span class="mf">195.43</span> <span class="n">ms</span>
    <span class="n">MAX</span><span class="p">:</span>        <span class="mf">264.55</span> <span class="n">ms</span>
<span class="n">Throughput</span><span class="p">:</span> <span class="mf">26.58</span> <span class="n">FPS</span>

<span class="n">Device</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i9</span><span class="o">-</span><span class="mi">10920</span><span class="n">X</span> <span class="n">CPU</span> <span class="o">@</span> <span class="mf">3.50</span><span class="n">GHz</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Benchmark INT8 model</span>
<span class="n">benchmark_model</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="n">int8_ir_path</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Benchmark unet_kits19_int8.xml with CPU for 15 seconds with async
inference</strong></p>
<p>Benchmark command:
<code class="docutils literal notranslate"><span class="pre">benchmark_app</span> <span class="pre">-m</span> <span class="pre">model/unet_kits19_int8.xml</span> <span class="pre">-d</span> <span class="pre">CPU</span> <span class="pre">-t</span> <span class="pre">15</span> <span class="pre">-api</span> <span class="pre">async</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-cdir</span> <span class="pre">model_cache</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Count</span><span class="p">:</span>          <span class="mi">840</span> <span class="n">iterations</span>
<span class="n">Duration</span><span class="p">:</span>       <span class="mf">15182.74</span> <span class="n">ms</span>
<span class="n">Latency</span><span class="p">:</span>
    <span class="n">Median</span><span class="p">:</span>     <span class="mf">108.56</span> <span class="n">ms</span>
    <span class="n">AVG</span><span class="p">:</span>        <span class="mf">108.08</span> <span class="n">ms</span>
    <span class="n">MIN</span><span class="p">:</span>        <span class="mf">72.64</span> <span class="n">ms</span>
    <span class="n">MAX</span><span class="p">:</span>        <span class="mf">128.09</span> <span class="n">ms</span>
<span class="n">Throughput</span><span class="p">:</span> <span class="mf">55.33</span> <span class="n">FPS</span>

<span class="n">Device</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i9</span><span class="o">-</span><span class="mi">10920</span><span class="n">X</span> <span class="n">CPU</span> <span class="o">@</span> <span class="mf">3.50</span><span class="n">GHz</span>
</pre></div>
</div>
</section>
<section id="visually-compare-inference-results">
<h2>Visually Compare Inference Results<a class="headerlink" href="#visually-compare-inference-results" title="Permalink to this headline">¶</a></h2>
<p>Visualize the results of the model on four slices of the validation set.
Compare the results of the FP32 IR model with the results of the
quantized INT8 model and the reference segmentation annotation.</p>
<p>Medical imaging datasets tend to be very imbalanced: most of the slices
in a CT scan do not contain kidney data. The segmentation model should
be good at finding kidneys where they exist (in medical terms: have good
sensitivity) but also not find spurious kidneys that do not exist (have
good specificity). In the next cell, we show four slices: two slices
that have no kidney data, and two slices that contain kidney data. For
this example, a slice has kidney data if at least 50 pixels in the
slices are annotated as kidney.</p>
<p>Run this cell again to show results on a different subset. The random
seed is displayed to allow reproducing specific runs of this cell.</p>
<blockquote>
<div><p>Note: the images are shown after optional augmenting and resizing. In
the Kits19 dataset all but one of the cases has input shape
<code class="docutils literal notranslate"><span class="pre">(512,</span> <span class="pre">512)</span></code>.</p>
</div></blockquote>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The sigmoid function is used to transform the result of the network</span>
<span class="c1"># to binary segmentation masks</span>
<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">logaddexp</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">))</span>


<span class="n">num_images</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span>

<span class="c1"># Load FP32 and INT8 models</span>
<span class="n">core</span> <span class="o">=</span> <span class="n">Core</span><span class="p">()</span>
<span class="n">fp_model</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">read_model</span><span class="p">(</span><span class="n">fp32_ir_path</span><span class="p">)</span>
<span class="n">int8_model</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">read_model</span><span class="p">(</span><span class="n">int8_ir_path</span><span class="p">)</span>
<span class="n">compiled_model_fp</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">compile_model</span><span class="p">(</span><span class="n">fp_model</span><span class="p">,</span> <span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">)</span>
<span class="n">compiled_model_int8</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">compile_model</span><span class="p">(</span><span class="n">int8_model</span><span class="p">,</span> <span class="n">device_name</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">)</span>
<span class="n">output_layer_fp</span> <span class="o">=</span> <span class="n">compiled_model_fp</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">output_layer_int8</span> <span class="o">=</span> <span class="n">compiled_model_int8</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create subset of dataset</span>
<span class="n">background_slices</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">kidney_slices</span> <span class="o">=</span> <span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">dataset</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">data_subset</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">background_slices</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">kidney_slices</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Set seed to current time. To reproduce specific results, copy the printed seed</span>
<span class="c1"># and manually set `seed` to that value.</span>
<span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Visualizing results with seed </span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">num_images</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="n">num_images</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_subset</span><span class="p">):</span>
    <span class="n">display_image</span> <span class="o">=</span> <span class="n">rotate_and_flip</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>
    <span class="n">target_mask</span> <span class="o">=</span> <span class="n">rotate_and_flip</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="c1"># Add batch dimension to image and do inference on FP and INT8 models</span>
    <span class="n">input_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">res_fp</span> <span class="o">=</span> <span class="n">compiled_model_fp</span><span class="p">([</span><span class="n">input_image</span><span class="p">])</span>
    <span class="n">res_int8</span> <span class="o">=</span> <span class="n">compiled_model_int8</span><span class="p">([</span><span class="n">input_image</span><span class="p">])</span>

    <span class="c1"># Process inference outputs and convert to binary segementation masks</span>
    <span class="n">result_mask_fp</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">res_fp</span><span class="p">[</span><span class="n">output_layer_fp</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">result_mask_int8</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">res_int8</span><span class="p">[</span><span class="n">output_layer_int8</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">result_mask_fp</span> <span class="o">=</span> <span class="n">rotate_and_flip</span><span class="p">(</span><span class="n">result_mask_fp</span><span class="p">)</span>
    <span class="n">result_mask_int8</span> <span class="o">=</span> <span class="n">rotate_and_flip</span><span class="p">(</span><span class="n">result_mask_int8</span><span class="p">)</span>

    <span class="c1"># Display images, annotations, FP32 result and INT8 result</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">display_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">target_mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result_mask_fp</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">result_mask_int8</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Prediction on FP32 model&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Prediction on INT8 model&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Visualizing</span> <span class="n">results</span> <span class="k">with</span> <span class="n">seed</span> <span class="mi">1663101109</span>
</pre></div>
</div>
<img alt="../_images/110-ct-segmentation-quantize-nncf-with-output_39_1.png" src="../_images/110-ct-segmentation-quantize-nncf-with-output_39_1.png" />
</section>
</section>
<section id="show-live-inference">
<h1>Show Live Inference<a class="headerlink" href="#show-live-inference" title="Permalink to this headline">¶</a></h1>
<p>To show live inference on the model in the notebook, we use the
asynchronous processing feature of OpenVINO.</p>
<p>We use the <code class="docutils literal notranslate"><span class="pre">show_live_inference</span></code> function from <a class="reference external" href="utils-with-output.html">Notebook
Utils</a> to show live inference. This
function uses <a class="reference external" href="https://github.com/openvinotoolkit/open_model_zoo/">Open Model
Zoo</a>’s
AsyncPipeline and Model API to perform asynchronous inference. After
inference on the specified CT scan has completed, the total time and
throughput (fps), including preprocessing and displaying, will be
printed.</p>
<blockquote>
<div><p>NOTE: you may experience flickering on Firefox. Please consider using
Chrome or Edge to run this notebook.</p>
</div></blockquote>
<section id="load-model-and-list-of-image-files">
<h2>Load Model and List of Image Files<a class="headerlink" href="#load-model-and-list-of-image-files" title="Permalink to this headline">¶</a></h2>
<p>We load the segmentation model to OpenVINO Runtime with
<code class="docutils literal notranslate"><span class="pre">SegmentationModel</span></code>, based on the <a class="reference external" href="https://github.com/openvinotoolkit/open_model_zoo/">Open Model
Zoo</a> Model API.
This model implementation includes pre and post processing for the
model. For <code class="docutils literal notranslate"><span class="pre">SegmentationModel</span></code> this includes the code to create an
overlay of the segmentation mask on the original image/frame.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CASE</span> <span class="o">=</span> <span class="mi">117</span>

<span class="c1"># The Live inference function uses the OpenVINO Runtime API which is compatible with</span>
<span class="c1"># OpenVINO LTS release 2021.4</span>
<span class="n">ie</span> <span class="o">=</span> <span class="n">IECore</span><span class="p">()</span>
<span class="n">segmentation_model</span> <span class="o">=</span> <span class="n">SegmentationModel</span><span class="p">(</span>
    <span class="n">ie</span><span class="o">=</span><span class="n">ie</span><span class="p">,</span> <span class="n">model_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">int8_ir_path</span><span class="p">),</span> <span class="n">sigmoid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rotate_and_flip</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">case_path</span> <span class="o">=</span> <span class="n">BASEDIR</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;case_</span><span class="si">{</span><span class="n">CASE</span><span class="si">:</span><span class="s2">05d</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">image_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">case_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;imaging_frames/*jpg&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">case_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">image_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> images&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">case_00117</span><span class="p">,</span> <span class="mi">69</span> <span class="n">images</span>
</pre></div>
</div>
</section>
<section id="show-inference">
<h2>Show Inference<a class="headerlink" href="#show-inference" title="Permalink to this headline">¶</a></h2>
<p>In the next cell, we run the <code class="docutils literal notranslate"><span class="pre">show_live_inference</span></code> function, which
loads the <code class="docutils literal notranslate"><span class="pre">segmentation_model</span></code> to the specified <code class="docutils literal notranslate"><span class="pre">device</span></code> (using
caching for faster model loading on GPU devices), loads the images,
performs inference, and displays the results on the frames loaded in
<code class="docutils literal notranslate"><span class="pre">images</span></code> in real-time.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Possible options for device include &quot;CPU&quot;, &quot;GPU&quot;, &quot;AUTO&quot;, &quot;MULTI:CPU,GPU&quot;</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;CPU&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">LoadImage</span><span class="p">(</span><span class="n">image_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="n">show_live_inference</span><span class="p">(</span>
    <span class="n">ie</span><span class="o">=</span><span class="n">ie</span><span class="p">,</span> <span class="n">image_paths</span><span class="o">=</span><span class="n">image_paths</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">segmentation_model</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">reader</span>
<span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/110-ct-segmentation-quantize-nncf-with-output_44_0.jpg" src="../_images/110-ct-segmentation-quantize-nncf-with-output_44_0.jpg" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Loaded</span> <span class="n">model</span> <span class="n">to</span> <span class="n">CPU</span> <span class="ow">in</span> <span class="mf">0.14</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">Total</span> <span class="n">time</span> <span class="k">for</span> <span class="mi">68</span> <span class="n">frames</span><span class="p">:</span> <span class="mf">1.99</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span><span class="mf">34.59</span>
</pre></div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p><strong>OpenVINO</strong> - <a class="reference external" href="https://github.com/openvinotoolkit/nncf/">NNCF
Repository</a> - <a class="reference external" href="https://arxiv.org/abs/2002.08679">Neural
Network Compression Framework for fast model
inference</a> - <a class="reference external" href="002-openvino-api-with-output.html">OpenVINO API
Tutorial</a> - <a class="reference external" href="https://pypi.org/project/openvino-dev/">OpenVINO
PyPI (pip install
openvino-dev)</a></p>
<p><strong>Kits19 Data</strong> - <a class="reference external" href="https://kits19.grand-challenge.org/">Kits19 Challenge
Homepage</a> - <a class="reference external" href="https://github.com/neheller/kits19">Kits19 Github
Repository</a> - <a class="reference external" href="https://arxiv.org/abs/1904.00445">The KiTS19
Challenge Data: 300 Kidney Tumor Cases with Clinical Context, CT
Semantic Segmentations, and Surgical
Outcomes</a> - <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1361841520301857">The state of the art
in kidney and kidney tumor segmentation in contrast-enhanced CT imaging:
Results of the KiTS19
challenge</a></p>
</section>
</section>


                </div>
            
            
                <div class='prev-next-bottom'>
                  
    <a class='button bttn-sec button-size-l' id="prev-link" href="107-speech-recognition-quantization-with-output.html" title="previous page">Prev</a>
    <a class='button bttn-sec button-size-l' id="next-link" href="110-ct-segmentation-quantize-with-output.html" title="next page">Next</a>

                </div>
            
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Intel®.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>